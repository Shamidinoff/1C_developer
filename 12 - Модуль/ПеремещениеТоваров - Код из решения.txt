//// ПЕЧАТНАЯ ФОРМА ДЛЯ ПЕРЕМЕЩЕНИЯ ТОВАРОВ.

Функция СведенияОВнешнейОбработке() Экспорт
ПараметрыРегистрации = Новый Структура;
МассивНазначений = Новый Массив;
МассивНазначений.Добавить("Документ.ПеремещениеТоваров");//Указываем документ к которому делаем внешнюю печ. форму
ПараметрыРегистрации.Вставить("Вид", "ПечатнаяФорма"); //может быть - ПечатнаяФорма, ЗаполнениеОбъекта, ДополнительныйОтчет,СозданиеСвязанныхОбъектов...
ПараметрыРегистрации.Вставить("Назначение", МассивНазначений);
ПараметрыРегистрации.Вставить("Наименование", "Перемещение товаров"); //имя под которым обработка будет зарегестрирована в справочнике внешних обработок
ПараметрыРегистрации.Вставить("БезопасныйРежим", Истина);
ПараметрыРегистрации.Вставить("Версия", "2.2.2.0");
ПараметрыРегистрации.Вставить("Информация", "Эту ВПФ мы сделали для того что бы посмотреть возможности БСП ");
ТаблицаКоманд = ПолучитьТаблицуКоманд();
ДобавитьКоманду(ТаблицаКоманд, "Перемещение товаров", "Перемещение товаров", "ВызовСерверногоМетода", ложь, "ПечатьMXL");
ПараметрыРегистрации.Вставить("Команды", ТаблицаКоманд);

Возврат ПараметрыРегистрации;
КонецФункции  

Функция ПолучитьТаблицуКоманд() Экспорт
Команды = Новый ТаблицаЗначений;
Команды.Колонки.Добавить("Представление", Новый ОписаниеТипов("Строка"));//как будет выглядеть описание печ.формы для пользователя
Команды.Колонки.Добавить("Идентификатор", Новый ОписаниеТипов("Строка")); //имя макета печ.формы
Команды.Колонки.Добавить("Использование", Новый ОписаниеТипов("Строка")); //ВызовСерверногоМетода
Команды.Колонки.Добавить("ПоказыватьОповещение", Новый ОписаниеТипов("Булево"));
Команды.Колонки.Добавить("Модификатор", Новый ОписаниеТипов("Строка"));
Возврат Команды;
КонецФункции   

Процедура ДобавитьКоманду(ТаблицаКоманд, Представление, Идентификатор, Использование, ПоказыватьОповещение = Ложь, Модификатор = "") экспорт

НоваяКоманда = ТаблицаКоманд.Добавить();
НоваяКоманда.Представление = Представление;
НоваяКоманда.Идентификатор = Идентификатор;
НоваяКоманда.Использование = Использование;
НоваяКоманда.ПоказыватьОповещение = ПоказыватьОповещение;
НоваяКоманда.Модификатор = Модификатор;

КонецПроцедуры 

Процедура Печать(МассивОбъектов, КоллекцияПечатныхФорм, ОбъектыПечати, ПараметрыВывода) Экспорт

УправлениеПечатью.ВывестиТабличныйДокументВКоллекцию(КоллекцияПечатныхФорм, "Перемещение товаров", "Перемещение товаров", СформироватьПечатнуюФорму(МассивОбъектов[0], ОбъектыПечати));
КонецПроцедуры



Функция СформироватьПечатнуюФорму(ССылкаНаОбъект, ОбъектыПечати)Экспорт 
	
	ТабДок = Новый ТабличныйДокумент;
	
	//{{КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА
	// Данный фрагмент построен конструктором.
	// При повторном использовании конструктора, внесенные вручную изменения будут утеряны!!!
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПеремещениеТоваров.Номер КАК Номер,
		|	ПеремещениеТоваров.Дата КАК Дата,
		|	ПеремещениеТоваров.СкладОтправитель КАК СкладОтправитель,
		|	ПеремещениеТоваров.СкладПолучатель КАК СкладПолучатель,
		|	ПеремещениеТоваров.Сотрудник КАК Сотрудник,
		|	ПеремещениеТоваров.Товар.(
		|		Ссылка КАК Ссылка,
		|		НомерСтроки КАК НомерСтроки,
		|		Номенклатура КАК Номенклатура,
		|		Количество КАК Количество,
		|		ЕдиницаИзмерения КАК ЕдиницаИзмерения
		|	) КАК Товар,
		|	НазваниеОрганизация.Значение КАК Организация
		|ИЗ
		|	Документ.ПеремещениеТоваров КАК ПеремещениеТоваров,
		|	Константа.НазваниеОрганизация КАК НазваниеОрганизация
		|ГДЕ
		|	ПеремещениеТоваров.Ссылка = &СсылкаНаДокумент";
	
	Запрос.УстановитьПараметр("СсылкаНаДокумент", ССылкаНаОбъект);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Выборка = РезультатЗапроса.Выбрать();
	
	Пока Выборка.Следующий() Цикл
		// Вставить обработку выборки ВыборкаДетальныеЗаписи
	КонецЦикла;
	
	//}}КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА


	
	Макет = ПолучитьМакет("МакетПеремещениеТоваров");
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
	ОбластьТело = Макет.ПолучитьОбласть("Тело");
	ОбластьПодвал = Макет.ПолучитьОбласть("Подвал");
	
	ОбластьШапка.Параметры.Номер = Выборка.Номер;
	ОбластьШапка.Параметры.Дата = Формат(Выборка.Дата,"ДЛФ=D"); 
	ОбластьШапка.Параметры.Организация = Выборка.Организация;
	ОбластьШапка.Параметры.СкладОтправитель = Выборка.СкладОтправитель;
	ОбластьШапка.Параметры.СкладПолучатель = Выборка.СкладПолучатель;
	Табдок.Вывести(ОбластьШапка);
	
	ВыборкаТовары = Выборка.Товар.Выбрать();
	Пока ВыборкаТовары.Следующий() Цикл
		ОбластьТело.Параметры.НомерСтроки = Выборка.НомерСтроки;
		ОбластьТело.Параметры.Номенклатура = Выборка.Номенклатура;
		ОбластьТело.Параметры.Количество = Выборка.Количество; 
		ОбластьТело.Параметры.ЕдиницаИзмерения = Выборка.ЕдиницаИзмерения;
		ТабДок.Вывести(ОбластьТело);
	КонецЦикла;
	
	
	ОбластьПодвал.Параметры.ОтветственноеЛицо = Выборка.Сотрудник; 
	Табдок.Вывести(ОбластьПодвал);  
	
	ВставлятьРазделительСтраниц = Истина;
	ТабДок.АвтоМасштаб = Истина;
	
	Возврат ТабДок;



КонецФункции


















